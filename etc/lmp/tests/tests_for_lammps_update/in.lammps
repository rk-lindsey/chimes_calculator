##########################################
##########################################
# NPT - testing LAMMPS in ChIMES Calculator
##########################################
##########################################
 
 
##########################################
# USER-SPECIFIED VARIABLES
##########################################

variable tstep               equal  0.5                                        # timestep in fs
variable run_steps           equal  500                                        # Number of steps to run
variable temperature         equal  3000                                       # Temperature (K)
variable pressure            equal  296077                                     # Target pressure (atm)  
 
variable io_freq             equal  10                                         # Frequency of dumping trajectory (500 steps, 250 fs)
 
variable data_file           string /scratch/08034/tg873340/LAMMPS_test/lammps_data_files/diamond_3.21gcc_512atoms.data.in  
variable param_file          string /scratch/08034/tg873340/LAMMPS_test/chimes_parameter_files/published_params.Carbon-2.0.Small.2+3+4b.Tersoff.txt

########################################
# GENERAL CONTROLS
######################################## 

units           real                          # Required for CHIMES pair style
newton          on                            # Required for CHIMES pair style
atom_style      atomic                        # Required for CHIMES pair style
atom_modify     sort 0 0.0                    # Prevent sorting (to maintain 3b parent/neighbor relationships)
atom_modify     map array                     # May improve efficiency
 
neighbor        1.5 bin
neigh_modify    delay 0 every 1 check yes
 
########################################
# INITIALIZATION CONTROLS
########################################

read_data       ${data_file}                                                           
velocity        all create ${temperature} 1234 dist gaussian mom yes rot yes loop all  # Assign initial velocity (comment this line out when reading from a restart file)


########################################
# FORCE FIELD CONTROLS 
########################################

pair_style      chimesFF                                                          
pair_coeff      * * ${param_file}                                


########################################
# RESTART CONTROLS 
########################################

restart         ${io_freq} a.restart b.restart	 # Write restart files

########################################
# RUN, DUMP, AND THERMO CONTROLS 
########################################

##### Set the ensemble
variable temp_damp  equal  v_tstep*100.0	# Temperature damping coefficient
variable press_damp equal  v_tstep*1000.0	# Pressure damping coefficient
fix             1 all npt temp ${temperature} ${temperature} ${temp_damp} iso ${pressure} ${pressure} ${press_damp}  # Couple pressure with "iso" for liquid system

##### Define thermo output 
variable e_ensemble        equal f_1
variable e_conserve        equal ke+pe+v_e_ensemble
thermo_style    custom step time temp press density ke pe etotal v_e_ensemble v_e_conserve econserve 
thermo_modify   line one format float %20.5f flush yes
thermo          ${io_freq}

##### Dump all atoms
#dump            dump_1 carbon ${io_freq} traj.lammpstrj id type element xu yu zu vx vy vz
#dump_modify     dump_1 sort id element C
 
##### Run the simulation 
 
timestep        ${tstep} 
run             ${run_steps} upto
