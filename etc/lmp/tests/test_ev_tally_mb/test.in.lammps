########################################
# GENERAL CONTROLS
######################################## 

units           real                          # Required for CHIMES pair style
newton          on                            # Required for CHIMES pair style
atom_style      atomic                        # Required for CHIMES pair style
atom_modify     sort 0 0.0                    # Prevent sorting (to maintain 3b parent/neighbor relationships)
atom_modify     map array                     # May improve efficiency

neighbor        1.5 bin
neigh_modify    delay 0 every 1 check yes

########################################

read_data       diamond_3.21gcc_512atoms.data.in
pair_style      chimesFF                                                          
pair_coeff      * * published_params.Carbon-2.0.Small.2+3+4b.Tersoff.txt



########################################
# RUN, DUMP, AND THERMO CONTROLS 
########################################

fix             1 all nve


##### Compute total stress (virial + kinetic), convert it to system pressure and compare with actual system pressure

compute  pe_atom  all   pe/atom
compute  total_pe all   reduce sum c_pe_atom
variable total_pe equal c_total_pe


# Define the per-atom stress tensor (6 components: xx, yy, zz, xy, xz, yz)
compute stress_atom all stress/atom NULL

# Sum the per-atom stresses across all atoms to get the total stress tensor components
compute total_stress all reduce sum c_stress_atom[1] c_stress_atom[2] c_stress_atom[3] c_stress_atom[4] c_stress_atom[5] c_stress_atom[6]

# Define variables for the total stress tensor components
variable Sxx equal c_total_stress[1] 
variable Syy equal c_total_stress[2] 
variable Szz equal c_total_stress[3] 
variable Sxy equal c_total_stress[4] 
variable Sxz equal c_total_stress[5] 
variable Syz equal c_total_stress[6] 

# Calculate pressure from the stress tensor: Pressure = -(Sxx + Syy + Szz) / (3*volume)
variable pressure equal -(v_Sxx+v_Syy+v_Szz)/(3.0*vol) 

##### Define thermo output 

#thermo_style    custom step temp pe v_total_pe press v_pressure v_Sxx v_Syy v_Szz v_Sxy v_Sxz v_Syz
thermo_style    custom press v_pressure v_Sxx v_Syy v_Szz
thermo_modify   line one format float %20.5f flush yes
thermo          1


##### Run the simulation 

timestep        0.5
run             1
 